<h1 id="best-practices">Best practices</h1>

<p>As soon as you need to store a date (with or without time), you should store a full datetime.
Even if it sounds like you don't need the time, timezone or anything more than the day-precision
for a date such as <code>2020-07-26</code> but July the 26th is not the same day for everyone.
July 26th start</p>

<p>Best practices when handling dates summarized in one sentence is: "Don't be stingy!"</p>

<p>When you're about to store a date like <code>2020-07-26</code>, it sounds like you don't need the time, timezone or
anything more than the day-precision. But first, this extra-precision does not cost much: 5 bytes.</p>

<p>You might be thinking all that complex stuff is not for you because your app is simple or different.
But it's not different, and it will be simple only following standards.</p>

<h1 id="configuration">Configuration</h1>

<p>SQL engines are capable to store date-time millisecond to nanosecond precision, but by default Laravel comes
with second-precision.</p>

<p>For instance, if you use MySQL, you should extend <code>MySqlGrammar</code> to change the date format:</p>

<pre><code class="php">&lt;?php
// app/Database/Query/Grammars/MySqlGrammar.php

namespace App\Database\Query\Grammars;

class MySqlGrammar extends \Illuminate\Database\Query\Grammars\MySqlGrammar
{
    public function getDateFormat()
    {
        return 'Y-m-d H:i:s.u';
    }
}</code></pre>

<p>Then edit the boot method of <strong>app/Providers/AppServiceProvider.php</strong>:</p>

<pre><code class="php">class AppServiceProvider extends ServiceProvider
{
    /**
    * Bootstrap any application services.
    *
    * @return void
    */
    public function boot()
    {
        DB::connection()->setQueryGrammar(new \App\Database\Query\Grammars\MySqlGrammar);
    }</code></pre>

<p>Then to be properly stored this precision, add the precision attribute (6 for 6-digits length decimal part) in
migrations, for instance the default migration of users would become to store the microseconds precision:</p>

<pre><code class="php">Schema::create('users', function (Blueprint $table) {
    $table->id();
    $table->string('name');
    $table->string('email')->unique();
    $table->timestamp('email_verified_at', 6)->nullable();
    $table->string('password');
    $table->rememberToken();
    $table->timestamps(6);
});</code></pre>

<p>If the migration has already been ran, use an update:</p>

<pre><code class="php">Schema::table('users', function (Blueprint $table) {
    $table->timestamp('created_at', 6)->nullable();
    $table->timestamp('updated_at', 6)->nullable();
});</code></pre>

<nav>
    <div class="col-md-3">
        <div id="affix-nav" class="hidden-print hidden-xs hidden-sm affix">
            <ul class="nav sidenav" data-spy="affix" data-offset-top="10">
                <li><a href="#best-practices">Best practices</a></li>
                <li><a href="#configuration">Configuration</a></li>
            </ul>
        </div>
    </div>
</nav>
